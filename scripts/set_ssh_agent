_set_ssh_agent()
{
  SSHAGENT=$(command -v ssh-agent)
  SSHAGENTARGS="-s"
  if ! pgrep -xu $USER ssh-agent &>/dev/null; then
    if [[ -z "$SSH_AUTH_SOCK" && -x "$SSHAGENT" ]]; then
      eval "$($SSHAGENT $SSHAGENTARGS)"
      trap "kill $SSH_AGENT_PID" 0
      ssh-add
    fi
  fi
}
_set_ssh_agent
